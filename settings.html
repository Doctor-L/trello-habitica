<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
  </head>
  <body>
    <h3>
      Habitica credentials
    </h3>
    <p>
    </p>
    What cards to sync: <br>
    <input id="scope-none" class="scope-radio" type="radio" name="scope" value="none"> All<br>
    <input id="scope-me" class="scope-radio" type="radio" name="scope" value="me"> Only assigned to me <br> <br>

    <input id="user-id" type="text" placeholder="User ID">
    <input id="api-token" type="password" placeholder="API Token">
    <button id="submit-btn" type="submit" class="mod-primary">Save</button>
  
    <script>
      let t = TrelloPowerUp.iframe()
      let $userId   = document.getElementById('user-id')
      let $apiToken = document.getElementById('api-token')

      t.get('member', 'private', 'settings', {scope: 'none'})
        .get('scope')
        .then(val => document.getElementById(`scope-${val}`).checked = true)

      t.get('member', 'private', 'userId').then(val => $userId.value = val)
      t.get('member', 'private', 'apiToken').then(val => $apiToken.value = val)

      document.getElementById('submit-btn').addEventListener('click', () => {
        let $radios = document.getElementsByClassName('scope-radio')
        let scope   = Array.from($radios).find(radio => radio.checked).value

        t.set('member', 'private', {
          settings: { scope },
          userId: $userId.value,
          apiToken: $apiToken.value
        })
          .then(() => {
            // now that we have the token we needed lets go on to letting
            // the user do whatever they need to do.
            return t.closePopup()
          })
      })
    </script>
  </body>
</html>