<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/habitica-api.js"></script>
    <script src="js/task.js"></script>
    <script src="js/list.js"></script>
  </head>
  <body>

    <b>Difficulty:</b>
    <select id="priority">
      <option value="0.5">Trivial</option>
      <option value="1">Easy</option>
      <option value="1.5">Medium</option>
      <option value="2">Hard</option>
    </select>

    <button id="submit-btn" type="submit" class="mod-primary">Save</button>
  
    <script>
      let t = TrelloPowerUp.iframe()
      let storage = new Storage(t)
      let $submitButton = document.getElementById('submit-btn')
      let $priority = document.getElementById('priority')

      storage.getTask().then(task => {
        $priority.value = task.priority
      })
      
      $submitButton.addEventListener('click', () => {
        $submitButton.disabled = true
        
        storage.getTask().then(task => {
          if (task.priority != $priority.value) {
            return new Task(t).handleUpdate({
                priority: $priority.value
              })
              .then(() => t.closePopup())
          } else {
            return t.closePopup()
          }
        })
      })
    </script>
  </body>
</html>